# 权利要求书

1. 一种基于伊辛模型的复杂系统故障定位方法，其特征在于，包括以下步骤：
   - (1) 收集复杂系统中各个传感器的读数，包括但不限于流量、温度、湿度等数据，同时记录对应的时间戳和设备运行状态标签；
   - (2) 对收集到的传感器数据进行清洗，去除异常值和噪声；
   - (3) 将不同传感器的数据进行归一化处理，使其具有相同的尺度范围；
   - (4) 将复杂系统中的每个传感器对应为伊辛模型中的一个节点，用自旋变量表示传感器的状态，其中自旋向上表示正常状态，自旋向下表示故障状态；
   - (5) 根据传感器之间的相关性以及传感器读数确定伊辛模型中的相互作用参数；
   - (6) 定义能量函数，该能量函数包括相互作用项、外部场项以及与传感器读数相关的项；
   - (7) 根据实际的设备状态标签和模型预测的状态以及能量函数定义损失函数；
   - (8) 随机初始化自旋变量、相互作用参数、外部场参数以及与传感器读数相关的参数；
   - (9) 使用优化算法最小化损失函数，更新参数；
   - (10) 采用蒙特卡洛方法进行迭代更新节点状态，根据当前的能量函数和温度参数，以一定的概率更新节点的自旋状态；
   - (11) 重复迭代直到系统达到热平衡状态或满足一定的收敛条件；
   - (12) 根据最终的节点自旋状态确定传感器的故障状态。

2. 根据权利要求 1 所述的基于伊辛模型的复杂系统故障定位方法，其特征在于，所述对收集到的传感器数据进行清洗的方法包括设定阈值筛选异常值和使用统计方法去除噪声。

3. 根据权利要求 1 所述的基于伊辛模型的复杂系统故障定位方法，其特征在于，所述数据归一化处理采用 min-max 归一化方法，公式为：
   $$
   \widetilde{x} = \frac{x - x_{\text{min}}}{x_{\text{max}} - x_{\text{min}}}
   $$
   其中 $x$ 是原始数据，$x_{\text{min}}$ 和 $x_{\text{max}}$ 分别是数据的最小值和最大值。

4. 根据权利要求 1 所述的基于伊辛模型的复杂系统故障定位方法，其特征在于，所述相互作用参数根据不同传感器读数之间的相关系数以及考虑传感器读数的变化趋势来确定。

5. 根据权利要求 1 所述的基于伊辛模型的复杂系统故障定位方法，其特征在于，所述整个模型的能量函数为：
  $$
  E = - \sum_{i,j} J_{ij} s_i s_j - \sum_i h_i s_i + \lambda \sum_i d_i^2 s_i
  $$
   其中 $J_{ij}$ 是相互作用参数，$s_i$ 是节点自旋变量，$h_i$ 是外部场参数，$d_i$ 是传感器读数与期望值的差值，$\lambda$ 是调节参数。
   
   节点 $i$ 的能量函数为：
  $$
  E(s_i) = - \sum_j J_{ij} s_i s_j - h_i s_i + \lambda d_i^2 s_i
  $$

6. 根据权利要求 1 所述的基于伊辛模型的复杂系统故障定位方法，其特征在于，所述损失函数应该既考虑能量函数，也考虑交叉熵损失函数。能量函数在伊辛模型中起着重要的作用，它决定了系统的状态和节点的自旋状态。在训练过程中，通过调整模型参数，也会影响能量函数的值。通常情况下，当系统达到稳定状态时，能量函数会处于较低的值。而在故障定位中，希望通过最小化能量函数来使系统处于更合理的状态，从而确定故障节点。另一方面，最小化交叉熵损失函数是为了使模型的预测结果尽可能接近实际的设备状态标签，从而提高故障定位的准确性。交叉熵损失函数衡量了模型预测的概率分布与实际标签之间的差异，通过优化算法不断调整模型参数，使得损失函数值逐渐减小。

   对于多分类问题，交叉熵损失函数的公式为：
   $$
   L_{CE} = - \sum_i \left( y_i \log(\hat{y}_i) + (1 - y_i) \log(1 - \hat{y}_i) \right)
   $$
   其中，$y_i$ 是节点状态的实际标签，$\hat{y}_i$ 是模型对节点状态为故障的预测概率。

   总损失函数为：
   $$
   L_{\text{total}} = \alpha L_{\text{CE}} + (1 - \alpha) E
   $$
   其中权重参数 $\alpha$ 平衡交叉熵损失和能量函数的贡献。

  为了求取 $\hat{y}_i$，提出一个中间变量：
  $$
  z_i = \frac{2}{T} \left( \sum_j J_{ij} s_i s_j + h_i s_i - \lambda d_i^2 s_i \right)
  $$
   这个实际上是节点在正常状态 ($s=1$, 对应于 $y=0$) 和故障状态 ($s=-1$, 对应于 $y=1$) 之间的能量差的缩放形式。

  因此，
  $$
  z_i = \frac{2}{T} \left( \sum_j J_{ij} s_i s_j + h_i s_i - \lambda d_i^2 s_i \right)
  $$

   为了将该中间变量，也就是能量转换为预测概率 $\hat{y}_i$，可以使用 sigmoid 函数：
   $$
   \hat{y}_i = \frac{1}{1 + e^{-z_i}}
   $$

7. 根据权利要求 1 所述的基于伊辛模型的复杂系统故障定位方法，其特征在于，所述优化算法为梯度下降法，对于相互作用参数、外部场参数以及与传感器读数相关的参数分别计算梯度并更新。

   (1) 首先计算损失函数对相互作用参数 $J_{ij}$ 的梯度：

   - **①** 假设损失函数对能量函数的关系已知，可以通过链式法则来计算。
   - **②** 对能量函数 $E$ 关于 $J_{ij}$ 求偏导可得：
     $$
     \frac{\partial E}{\partial J_{ij}} = - s_i s_j
     $$
   - **③** 对交叉熵损失函数 $L_{CE}$ 关于 $J_{ij}$ 的梯度通常需要通过链式法则结合模型预测概率对 $J_{ij}$ 的依赖关系来计算，设其为 $\frac{\partial L_{CE}}{\partial J_{ij}}$，则总损失函数对的梯度为：
     $$
     \frac{\partial L_{\text{total}}}{\partial J_{ij}} = \alpha \frac{\partial L_{CE}}{\partial J_{ij}} + (1 - \alpha) \frac{\partial E}{\partial J_{ij}} = \alpha \frac{\partial L_{CE}}{\partial J_{ij}} - (1 - \alpha) s_i s_j
     $$

   (2) 计算损失函数对外场参数 $h_i$ 的梯度：

   - **①** 对能量函数 $E$ 关于 $h_i$ 求偏导可得：
     $$
     \frac{\partial E}{\partial h_i} = - s_i
     $$
   - **②** 对交叉熵损失函数关于 $h_i$ 的梯度设为 $\frac{\partial L_{CE}}{\partial h_i}$。
   - **③** 则总损失函数对 $h_i$ 的梯度为：
     $$
     \frac{\partial L_{\text{total}}}{\partial h_i} = \alpha \frac{\partial L_{CE}}{\partial h_i} + (1 - \alpha) \frac{\partial E}{\partial h_i} = \alpha \frac{\partial L_{CE}}{\partial h_i} - (1 - \alpha) s_i
     $$

   (3) 计算损失函数对与传感器读数相关参数（如调节参数 $\lambda$ 等）的梯度：

   - **①** 对能量函数 $E$ 关于 $\lambda$ 求偏导可得：
     $$
     \frac{\partial E}{\partial \lambda} = \sum_i d_i^2 s_i
     $$
   - **②** 对交叉熵损失函数 $L_{CE}$ 关于 $\lambda$ 的梯度设为 $\frac{\partial L_{CE}}{\partial \lambda}$。
   - **③** 则总损失函数对 $\lambda$ 的梯度为：
     $$
     \frac{\partial L_{\text{total}}}{\partial \lambda} = \alpha \frac{\partial L_{CE}}{\partial \lambda} + (1 - \alpha) \frac{\partial E}{\partial \lambda} = \alpha \frac{\partial L_{CE}}{\partial \lambda} + (1 - \alpha) \sum_i d_i^2 s_i
     $$

8. 根据权利要求 1 所述的基于伊辛模型的复杂系统故障定位方法，其特征在于，通过交替迭代更新模型权值以及模型节点状态。具体过程为：

   更新状态：

   1. 对于每个节点，假设当前状态为 $s_i^{\text{current}}$，翻转其状态（即 $s_i^{\text{new}} = - s_i^{\text{current}}$）后，计算能量变化：
      $$
      \Delta E = E(s_i^{\text{new}}) - E(s_i^{\text{current}})
      $$
  根据能量函数公式：
  $$
  E(s_i) = - \sum_j J_{ij} s_i s_j - h_i s_i + \lambda d_i^2 s_i
  $$
  翻转状态后的能量差可简化为：
  $$
  \Delta E = 2 s_i^{\text{current}} \left( \sum_j J_{ij} s_j + h_i - \lambda d_i^2 \right)
  $$

   2. 根据 Metropolis 准则，接受翻转的概率为：
      $$
      p = \min\left(1, e^{-\Delta E / T}\right)
      $$
      其中 $T$ 为温度参数。具体操作：
      - 生成一个均匀随机数 $r \in [0, 1]$
      - 若 $r < p$，则接受翻转，即 $s_i^{\text{new}} = - s_i^{\text{current}}$，否则保持原状态。

   注意：随机选择节点进行翻转，或者按照顺序遍历每个节点依次翻一遍。

   更新权值：按照前面推导的参数更新公式更新公式

   - **①** 对于相互作用参数 $J_{ij}$：
     $$
     J_{ij}^{\text{new}} = J_{ij} - \beta \frac{\partial L_{\text{total}}}{\partial J_{ij}}
     $$
     其中 $\beta$ 是学习率。
   - **②** 对于外场参数 $h_i$：
     $$
     h_i^{\text{new}} = h_i - \beta \frac{\partial L_{\text{total}}}{\partial h_i}
     $$
   - **③** 对于与传感器读数相关参数（如调节参数 $\lambda$）：
     $$
     \lambda^{\text{new}} = \lambda - \beta \frac{\partial L_{\text{total}}}{\partial \lambda}
     $$

9. 根据权利要求 1 所述的基于伊辛模型的复杂系统故障定位方法，其特征在于，根据计算出的预测概率判断节点状态。具体过程为：

   (1) 计算每个节点 $i$ 的预测概率：

   - **①** 因为：
     $$
     \hat{y}_i = \frac{1}{1 + e^{-z_i}}
     $$
  其中：
  $$
  z_i = \frac{2}{T} \left( \sum_j J_{ij} s_i s_j + h_i s_i - \lambda d_i^2 s_i \right)
  $$
   - **②** 状态判定：
     - 如果 $\hat{y}_i \geq 0.5$，则认为节点 $i$ 处于故障状态 $s_i = -1$
     - 如果 $\hat{y}_i < 0.5$，则认为节点 $i$ 处于正常状态 $s_i = 1$

# 技术领域

本发明涉及故障诊断技术领域，具体为一种基于伊辛模型的复杂系统故障定位方法。尤其适用于具有多个传感器的复杂系统，如空调机组等，通过将传感器网络与伊辛模型相结合，利用传感器读数和伊辛模型的特性，实现对复杂系统中可能出现的故障进行准确、高效的定位。该方法涵盖了数据采集与处理、模型构建、参数训练以及故障定位等多个技术环节，可广泛应用于工业自动化、智能设备维护、物联网等领域，为保障复杂系统的稳定运行和及时维修提供有力的技术支持。

# 背景技术

随着现代工业和科技的不断发展，复杂系统在各个领域中的应用越来越广泛。例如，在空调机组等复杂系统中，通常配备有多个传感器来监测不同的物理参数，如流量、温度、湿度等。这些传感器的数据对于系统的正常运行和故障诊断至关重要。然而，传统的故障诊断方法在面对复杂系统时往往存在一些局限性。一方面，对于具有大量传感器和复杂结构的系统，传统方法可能难以准确地定位故障源，需要耗费大量的时间和人力进行排查。另一方面，传统方法可能无法充分利用传感器之间的相关性和系统的物理特性，导致故障诊断的准确性和效率不高。因此，迫切需要一种新的故障定位方法，能够充分利用复杂系统中传感器的数据，结合先进的数学模型和算法，实现对故障的快速、准确定位。伊辛模型作为一种物理模型，在处理复杂系统的问题上具有一定的潜力。通过将复杂系统中的传感器对应为伊辛模型中的节点，并根据传感器之间的相关性和物理特性定义相互作用参数，可以利用伊辛模型的特性来分析系统的状态，从而实现故障定位。
